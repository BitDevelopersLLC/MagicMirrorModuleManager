<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MMMM</title>
  <link rel="stylesheet" href="./mdl/material.css">
  <script src="./mdl/material.min.js"></script>
  <script src="jquery.js"></script>
  <script src="./mdl/dialog-polyfill.js"></script>
  <link rel="stylesheet" type="text/css" href="dialog-polyfill.css" />

  <style>

  @font-face {
     font-family: 'Material Icons';
     font-style: normal;
     font-weight: 400;
     src: url(mdl/material-design-icons/iconfont/MaterialIcons-Regular.eot); /* For IE6-8 */
     src: local('Material Icons'),
          local('MaterialIcons-Regular'),
          url(mdl/material-design-icons/iconfont/MaterialIcons-Regular.woff2) format('woff2'),
          url(mdl/material-design-icons/iconfont/MaterialIcons-Regular.woff) format('woff'),
          url(mdl/material-design-icons/iconfont/MaterialIcons-Regular.ttf) format('truetype');
  }

  .material-icons {
    font-family: 'Material Icons';
    font-weight: normal;
    font-style: normal;
    font-size: 24px;  /* Preferred icon size */
    display: inline-block;
    line-height: 1;
    text-transform: none;
    letter-spacing: normal;
    word-wrap: normal;
    white-space: nowrap;
    direction: ltr;

    /* Support for all WebKit browsers. */
    -webkit-font-smoothing: antialiased;
    /* Support for Safari and Chrome. */
    text-rendering: optimizeLegibility;

    /* Support for Firefox. */
    -moz-osx-font-smoothing: grayscale;

    /* Support for IE. */
    font-feature-settings: 'liga';
  }


  .demo-card-wide.mdl-card {
    width: 384px;
  }
  .demo-card-wide > .mdl-card__title {
    color: #fff;
    height: 65px;
    background-color: #485cb0;
  }
  .demo-card-wide > .mdl-card__menu {
    color: #fff;
  }

  .demo-list-control {
    width: 300px;
  }
  .demo-list-radio {
    display: inline;
  }

  .page-content {
    margin: auto;
    padding-top: 0.25cm;
  }

  .mdl-grid {
  padding: 0!important;
  margin: auto;
}

.mdl-cell {
  background: #FFF0F5;
  padding-bottom: calc(1vh * 8.7);
  padding-top: calc(1vh * 0);
  text-align: center;
  text-transform: none;
  font-size: 2.5vw;
  color: #000000;
  font-weight: lighter;
  margin: 7px;
  cursor: pointer;
}

.cell--3-col-tablet.mdl-cell--3-col-tablet {
  width: calc(33.3333% - 16px);
  margin-right: auto;
  margin-left: auto;
}

.mdl-cell--1-col, .mdl-cell--1-col-tablet.mdl-cell--1-col-tablet {
  width: calc(33.3333% - 16px);
  margin-right: auto;
  margin-left: auto;
}

.mdl-cell--3-col {
  width: calc(100vw - 16px);
  margin-right: auto;
  margin-left: auto;
}

.more-options {
  margin-right: 0;
  margin-left: auto;
}

.update-positions-button {
  width: calc(100vw - 16px);
  margin-right: auto;
  margin-left: auto;
  margin-top: 5px;
}


  #sortable1, #sortable2, #sortable3 {
    border: 1px solid #eee;
    width: 200px;
    min-height: 20px;
    list-style-type: none;
    margin: 0;
    padding: 5px 0 0 0;
    float: left;
    margin-right: 10px;
  }
  #sortable1 li, #sortable2 li, #sortable3 li {
    margin: 0 5px 5px 5px;
    padding: 5px;
    font-size: 1.2em;
    width: 120px;
  }


  </style>

<dialog class="mdl-dialog">  
      <h1 id="dialogTitle" class="mdl-dialog__title">Add Module</h1>
      <div class="mdl-dialog__content">

        <p id="dialogInstructions">
          Paste the module's GitHub URL:
        </p>

        <!-- Simple Textfield -->
        <form action="#" id="dialogTextFieldForm">
          <div class="mdl-textfield mdl-js-textfield" id="dialogTextFieldDiv">
            <input class="mdl-textfield__input" type="text" id="dialogTextField">
            <label class="mdl-textfield__label" for="dialogTextField" id="dialogLabel">https://github.com/EliteByte/MMM-example</label>
          </div>
        </form>

        <!-- Floating Multiline Textfield -->
        <form action="#">
          <div class="mdl-textfield mdl-js-textfield" id="dialogMultiLineDiv">
            <textarea class="mdl-textfield__input" type="text" rows= "3" id="dialogMultiLine"></textarea>
            <label class="mdl-textfield__label" for="dialogMultiLine" id="dialogMultiLineLabel">
              { <br/>
                &emsp; module: "clock", <br/>
                &emsp; position: "top_left", <br/>
                &emsp; config: { <br/>
                  &emsp; &emsp; // The config property is optional. <br/>
                  &emsp; &emsp; // See 'Configuration options' for more information. <br/>
                &emsp; } <br/>
              } <br/>
            </label>
          </div>
        </form>

      </div>

    <div class="mdl-dialog__actions">
      <button type="button" id="dialogNextButton" class="mdl-button" onclick="dialogNext()">Next</button>
      <button type="button" id="dialogCancelButton" class="mdl-button close">Cancel</button>
      <br> </br>
      <div id="dialogProgress" class="mdl-progress mdl-js-progress"></div>
    </div>

</dialog>
</head>

<body>

  <!-- Simple header with fixed tabs. -->
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header
              mdl-layout--fixed-tabs">
    <header class="mdl-layout__header">
      <div class="mdl-layout__header-row">
        <!-- Title -->
        <span class="mdl-layout-title">MMMM</span>
      </div>
      <!-- Tabs -->
      <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
        <a id="firstTab" href="#fixed-tab-1" class="mdl-layout__tab is-active">Modules</a>
        <a id="secondTab" href="#fixed-tab-2" class="mdl-layout__tab">Config</a>
        <a id="thirdTab" href="#fixed-tab-3" class="mdl-layout__tab">Position</a>
      </div>
    </header>
    <div class="mdl-layout__drawer">
      <span class="mdl-layout-title">MMMM</span>
    </div>
    <main class="mdl-layout__content">

      <!-- First Tab -->
      <section class="mdl-layout__tab-panel is-active" id="fixed-tab-1">
        <div align="center" class="page-content">
          <!-- Start Module List Card -->
          <div  align="center" class="demo-card-wide mdl-card mdl-shadow--2dp">
            <ul id="sortable1"  align="center" class="demo-list-control mdl-list">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text" text-align="center">Modules</h2>
            </div>
            </ul>

            <button id="add-module" type="button" class="mdl-button mdl-button--colored">Add Module</button>

            <button id="update-modules" type="button" class="mdl-button mdl-button--colored">Update Modules</button>
          </div>
        </div>
      </section>

      <!-- Second Tab -->
      <section class="mdl-layout__tab-panel" id="fixed-tab-2">
        <div align="center" class="page-content">
            <!-- Start Config Card -->
            <div  align="center" id="configCard" class="demo-card-wide mdl-card mdl-shadow--2dp">

              <div class="mdl-card__title">
                <h2 class="mdl-card__title-text">Config</h2>
              </div>

              <ul id="configList" class="demo-list-control mdl-list">
                <li class="mdl-list__item" id="superman">
                  <span class="mdl-list__item-primary-content">
                    <i class="material-icons ">chrome_reader_mode</i>
                    Enabled
                  </span>
                  <span class="mdl-list__item-secondary-action">
                    <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="enableButton">
                      <input type="checkbox" id="enableButton" class="mdl-switch__input" checked />
                    </label>
                  </span>
                </li>
              </ul>

            <div class="mdl-card__actions mdl-card--border">
              </div>

              <button id="updateButton" align="center" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onclick="updateConfig()">
                Update
              </button>

                <!-- Position Button - Top Right -->
                <div class="mdl-card__menu">
                  <button id="positionButton"
                          class="mdl-button mdl-js-button mdl-button--icon">
                    <i class="material-icons">my_location</i>
                  </button>
                </div>
                <ul id="positionList" class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect"
                  for="positionButton">
                </ul>
                <!-- End Position Button -->

                <!-- Remove Module Button - Top Right -->
                <div class="mdl-card__menu" style="margin-right: 35px; ">
                  <button id="removeButton"
                          class="mdl-button mdl-js-button mdl-button--icon" onclick="removeModule()">
                    <i class="material-icons">remove_circle_outline</i>
                  </button>
                </div>
                <!-- End Remove Module Button -->

                <!-- Update Module Button - Top Right -->
                <div class="mdl-card__menu" style="margin-right: 70px; ">
                  <button id="removeButton"
                          class="mdl-button mdl-js-button mdl-button--icon" onclick="updateModule()">
                    <i class="material-icons">update</i>
                  </button>
                </div>
                <!-- End Update Module Button -->

          </div>

          <div id="tab-2" class="mdl-js-snackbar mdl-snackbar">
            <div class="mdl-snackbar__text"></div>
            <button class="mdl-snackbar__action" type="button"></button>
          </div>
        </div>
      </section>

      <!-- Third Tab -->
      <section class="mdl-layout__tab-panel" align="center" id="fixed-tab-3">
        <div id="positionContent" class="page-content positionContent" style="padding-top: 0;" align="center">
          <div>

          <!-- Raised button with ripple -->
          <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect update-positions-button" onclick="updateConfigPositions()">
            Update
          </button>

          <div  class="demo-grid-ruler mdl-grid">
              <div id="pos-top_bar" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--3-col">Top Bar</div>
           </div>

           <div  class="demo-grid-2 mdl-grid">
             <div id="pos-top_left" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--1-col">Top Left</div>
             <div id="pos-top_center" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--1-col">Top Center</div>
             <div id="pos-top_right" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--1-col">Top Right</div>
            </div>

           <div  class="demo-grid-ruler mdl-grid">
              <div id="pos-upper_third" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--3-col mdl-cell--9-col-tablet">Upper Third</div>
            </div>

            <div  class="demo-grid-ruler mdl-grid">
               <div id="pos-middle_center" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--3-col mdl-cell--9-col-tablet">Middle Center</div>
             </div>

             <div  class="demo-grid-ruler mdl-grid">
                <div id="pos-lower_third" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--3-col mdl-cell--9-col-tablet">Lower Third</div>
              </div>

             <div  class="demo-grid-2 mdl-grid">
               <div id="pos-bottom_left" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--1-col">Bottom Left</div>
               <div id="pos-bottom_center" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--1-col">Bottom Center</div>
               <div id="pos-bottom_right" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--1-col">Bottom Right</div>
              </div>

              <div  class="demo-grid-ruler mdl-grid">
                 <div id="pos-bottom_bar" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--3-col mdl-cell--9-col-tablet">Bottom Bar</div>
               </div>

          </div>
          <div id="tab-3" class="mdl-js-snackbar mdl-snackbar">
            <div class="mdl-snackbar__text"></div>
            <button class="mdl-snackbar__action" type="button"></button>
          </div>
        </div>
      </section>
    </main>
  </div>
<script src="../MagicMirror/config/config.js"></script>
<script src="socket.io.js"> </script>
<script type="text/javascript">
<!--
if (screen.width >= 699) {
    var positionContent = document.getElementById('positionContent');
    var thirdPositions = document.getElementsByClassName("mdl-cell");
    var updatedPositionButtons = document.getElementsByClassName("update-positions-button");

    positionContent.style.width = "75%";
    for (third in thirdPositions) {
     thirdPositions[third].width
    }
    updatedPositionButtons[0].style.width = "100%";
}
//-->
</script>

<script>

/**
 * @file MMMM JavaScript Handler
 * @author Mario Figueroa <mario@thermalwebcreations.com>
 * @version 0.1 Alpha
 */

  var rawModules = config.modules;
  var arrayModules = [];

  var mapModulePositions = {};
  var mapModulePositionsReverse = {};

  var updatedPosition = null;
  var currentPosition = null;

  var updateStatic = false;
  var currentModule = null;
  var currentModulePos = null;

  var fullDynamicConfig = config;
  var dynamicConfig = {};

  var selectedPosition = null;
  var takenPositionsDynamic = mapModulePositions;

  var dialogInfo = { page: 1 };

  var socketURL = ("http://" + window.location.hostname + ":" + window.location.port);
  var socket = io(socketURL, {transports: ['websocket', 'polling', 'flashsocket']});

    /**
    * Pre-Initialization Functions
    *
    * @function {Void} [v0.1] checkHash - Check the URL Hash to see if the client has already selected a module.
    * @function {Void} [v0.1] parseModules - Concise description of the tag.
    */

        /**
        * CheckHash - Search for a module in rawModules by it's name. [v0.1]
        *
        * @executes {Function} populateConfigCard() - If URL does contain a valid hash then it will load up the respective config in Config-Tab.
        * @throws {Error} hashNameDNE - If the URL has a hashname that can't be found as a module it will throw an exception.
        * @logging {Info} urlDNCHash - If the URL DNC (Does Not Contain) a hash it will just log it.
        */
        function checkHash() {
          var href = window.location.href;
            if(href.indexOf("#") > 0) {
              // NOTE: Dissect hash from URL and store as hashName.
              var hashName = window.location.hash.substr(1, window.location.hash.lastIndexOf(''));
              var modules = document.getElementById('sortable1').childNodes;

              if (findModule(hashName)) {
                for (li in modules) {
                  if (modules[li].tagName == 'LI') {
                    if (modules[li].innerHTML == hashName) {
                      // NOTE: Paint previously selected module to pink.
                      modules[li].style.backgroundColor = "#ec4174";
                    }
                  }
                }
                // NOTE: Load previously selected module, in Config-Tab.
                populateConfigCard(findModule(hashName));
              } else {
                // NOTE: Throw exception, hashNameDNE.
                console.error("Client Requested a hashname which doesn't exist.");
              }
            } else {
              // NOTE: Log, URL does not contain hash.
              console.log("URL Requested, does not contain a known anchor hash.");
            }
          }

        /**
        * Parse Modules - Search for a module in rawModules by it's name. [v0.1]
        *
        * @set {Variable} Sets up an object (mapModulePositions) to contain all modules with a configurable position.
          * @format Keys = ["moduleName", "moduleName", ...], Values = ["modulePosition", "modulePosition", ...]
        * @set {Variable} Sets up an object (mapModulePositionsReverse) like it's parent (mapModulePositions) but keys/values flipped.
          * @format Keys = ["modulePosition", "modulePosition", ...], Values = ["moduleName", "moduleName", ...]
        */
        function parseModules() {
          for (mod in rawModules) {
            if (rawModules[mod].position != null) {
              mapModulePositions[rawModules[mod].module] = rawModules[mod].position;
              mapModulePositionsReverse[rawModules[mod].position] = rawModules[mod].module;
            }
          }
        }

    /**
    * End of, Pre-Initialization Functions
    */



    /**
    * Utility Functions
    *
    * @function {Object} [v0.1] findModule() - Search for a module in rawModules by it's name.
    * @function {Object} [v0.1] findModulePosition() - Search for a module's position in the array rawModules.
    * @function {Void}   [v0.1] snackBar() - Overlays a message on the bottom of the Client's screen.
    * @function {Array}  [v0.1] positionsNotTaken() - Loop throught all rawModules positions and take them away from all possible positions; and then return one's left.
    */

        /**
        * Find Module - Search for a module in rawModules by it's name. [v0.1]
        *
        * @param {String} name - Name of module, i.e. [alert, weatherforecast, updatenotification]
        * @returns {Object} module - A module as an object from the config.js.
        * @child {Function} findModulePosition() - Derivative of this function.
        */
        function findModule(name) {
          for (mod in rawModules) {
            if (rawModules[mod].module == name) {
              return rawModules[mod];
            }
          }
        }

        /**
        * Find Module Position - Search for a module in rawModules and get its rawModules {Array} position. [v0.1]
        *
        * @param {String} name - Name of module, i.e. [alert, weatherforecast, updatenotification]
        * @returns {Integer} int - Integer that references the module when doing rawModules[int];
        * @parent {Function} findModule() - Anti-Derivative of this function.
        */
        function findModulePosition(name) {
          var int = -1;

          for (mod in rawModules) {
            int += 1;
            if (rawModules[mod].module == name) {
              return int;
            }
          }
        }

        /**
        * Snack Bar - Presents a MDL snackBar message for a few seconds. [v0.1]
        *
        * @param {String} msg - The message being displayed.
        * @param {Integer} tab - The tab number that you want it to be overlayed on.
        * @dependency {JavaScript} mdl - The Material Design Lite package by Google.
        */
        function snackBar(msg, tab) {
          var snackbarContainer = document.querySelector('#tab-' + tab);
          var data = {message: msg};
          snackbarContainer.MaterialSnackbar.showSnackbar(data);
        }

        /**
        * Trigger Handicap - Easy function to "handicap" element(s). [v0.1]
        *
        * @param {[Object]} parts - Array of Objects that will be affected.
          * @example triggerHandicap(elementID: "disable | enable | show | hide", ...);
        */
        function triggerHandicap(parts) {
          var partKeys = Object.keys(parts);

          for (part in partKeys) {
            var partElement = document.getElementById(partKeys[part]);

            switch (parts[partKeys[part]]) {
              case "disable":
                partElement.disabled = true;
              break;

              case "enable":
                partElement.disabled = false;
              break;

              case "show":
                partElement.style.display = "initial";
              break;

              case "hide":
                partElement.style.display = "none";
              break;

              default:
              console.error("triggerHandicap() was called with key, " + parts[partKeys[part]] + " but the key's value which was passed didn't satisfy any elements. Try, [disable | enable | show | hide]");
            }
          }
        }


        /**
        * Positions Not Taken - Loop through all rawModules positions and take them away from all possible positions; and then return the one's left. [v0.1]
        *
        * @returns {Array} allPositions - Returns all possible module positions minus the one's taken.
        */
        function positionsNotTaken() {
          var allPositions = ["top_bar", "bottom_bar", "top_left", "bottom_left", "top_right", "bottom_right", "top_center", "bottom_center", "upper_third", "middle_center", "lower_third"];

          for (pos in mapModulePositions) {
            for (var i=allPositions.length-1; i>=0; i--) {
              if (allPositions[i] === mapModulePositions[pos]) {
                allPositions.splice(i, 1);
              }
            }
          }
          return allPositions;
        }


        function sendOutData(data) {
          return new Promise( function (resolve, reject) {
            socket.emit('configUpdate', data, function (response) {
              resolve(response);
              return response;
            });
          }, function (error) {
            console.error("Error emiting data through socket. -> [ " + error + " ]");
            return false;
          });
          try {

          } catch (err) {

          }
        }

        function removeModule() {
          var moduleName = currentModule.module;

          try {
            var removedConfig = config;
            var index = removedConfig.modules.indexOf(currentModule);
            removedConfig.modules.splice(index, 1);

            var data = ("var config = " + JSON.stringify(removedConfig, null, "\t") + ";" + "\n if (typeof module !== 'undefined') {module.exports = config;}");
            socket.emit('removeModuleConfig', data, function (confirmation) {
              if (confirmation == true) {
                console.log("Successfully removed " + moduleName + "'s entry from config.js \nMoving onto removing it from the server's version management system. (repos.js)");

                socket.emit('removeModule', { 'moduleName': moduleName }, function (secondConfirmation) {
                  if (secondConfirmation == true) {
                    console.log("Successfully finished all existence of " + moduleName);
                    location.reload();
                    flushHash();
                  } else {
                    console.error("Failed removing module from repos.js. \nDetails from server -> " + secondConfirmation);
                  }
                });
              } else {
                console.error("Failed removing module from config.js. \nDetails from server -> " + secondConfirmation);
              }
            });

            return true;
          } catch (err) {
            console.error("Failed removing module " + moduleName + " \nDetails -> " + err);
            return false;
          }
        }

        function sendOutGitHubRequest(requestType, repoURL) {
          return new Promise(function (resolve, reject) {
            switch (requestType) {
              case "clone":
                socket.emit('clone', { type: 'clone', repo: repoURL }, function (response) {
                  if (response == true) {
                    resolve(response);
                  } else {
                    reject(response);
                    console.error(response);
                    snackBar(("Failed cloning the module with error: " + response), 1);
                  }
                });
                
                break;
              case "pull":
                socket.emit('pull', { type: 'pull', repo: repoURL });
                break;
              default:
                console.error("[Error] Function, sendOutGitHubRequest() failed. \n Caused by an unknown requestType -> " + requestType);
            }
            return true;
          });
        }

        function updateModule() {
          return new Promise(function (resolve, reject) {
            socket.emit('updateModule', { module: currentModule.module }, function (response) {
              if (response == true) {
                console.info("Successfully updated module, " + currentModule.module + ".");
                snackBar(("Successfully updated module, " + currentModule.module + "."), 2);
                resolve(true);
              } else {
                console.error("Error after emiting updateModule to server. \nDetails -> " + response);
                reject(response);
                return response;
              }
            });
          });
        }

        function flushHash() {
          window.location.hash = "";
        }


    /**
    * End of, Utility Functions
    */




    /**
    * Tab #1 || Modules-Tab Functions
    *
    * @function {Object} [v0.1] appendModules() - Add/Append all modules that are taken from the config.js.
    */

        /**
        * Append Modules - Add/Append all modules that are taken from the config.js file. [v0.1]
        */
        function appendModules() {
          var ul = document.getElementById("sortable1");
          var buttonWidthSync = "180px";
          var arryNumber = -1;

          // NOTE: Go through all rawModules and add them to the module list.
          for (mod in rawModules) {
            var li = document.createElement("li");
            var btn = document.createElement("button");
            li.appendChild(btn);
            li.className = "mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored";
            li.innerHTML = rawModules[mod].module;
            li.style = "cursor:pointer";
            li.style.fontSize = "15px";
            li.style.width = buttonWidthSync;
            li.style.textAlign = "center";
            arrayModules.push(rawModules[mod].module);
            arryNumber = arryNumber + 1;
            li.id = arryNumber;

            li.addEventListener('click', function(e) {
              for (li in this.parentNode.childNodes) {
                if (this.parentNode.childNodes[li].tagName == 'LI') {
                  // NOTE: Reset all module's color to (unselected) blue.
                  this.parentNode.childNodes[li].style.backgroundColor = "#3b5bb4";
                }
              }
              // NOTE: Set selected module to pink.
              this.style.backgroundColor = "#ec4174";
              var targetName = arrayModules[this.id];

              // NOTE: Set URL hash to module's name i.e. (localhost:1984/#calendar)
              var href = window.location.href;
              if (href.indexOf("#") > 0) {
                href = href.split("#")[0] + "?var=1#" + href.split("#")[1];
                window.location.hash = '';
              }
              location.hash = ("#" + targetName);

              // NOTE: Clear all previous config items in Config-Tab, using jQuery.
              $("li[id=configItem]").remove();

              // NOTE: After 20ms populateConfigCard() and click on the Config-Tab.
              setTimeout(function () { populateConfigCard(findModule(targetName));
              document.getElementById("secondTab").click();}, 20);
            });

            ul.appendChild(li);
          }
        }

        function handleDialogue() {
          var dialog = document.querySelector('dialog');
          var addModuleButton = document.querySelector('#add-module');

          var dialogTextFieldDiv = document.getElementById("dialogTextFieldDiv");
          var dialogMultiLineLabel = document.getElementById("dialogMultiLineLabel");
          var dialogMultiLine = document.getElementById("dialogMultiLine");
          var dialogMultiLineDiv = document.getElementById("dialogMultiLineDiv");


          triggerHandicap({dialogMultiLine: "hide", dialogMultiLineLabel: "hide"});

          if (! dialog.showModal) {
            dialogPolyfill.registerDialog(dialog);
          }
          addModuleButton.addEventListener('click', function() {
            dialog.showModal();
          });

          dialog.querySelector('.close').addEventListener('click', function() {
            dialogPage = 0;
            dialogProgress.MaterialProgress.setProgress(0);
            dialog.close();
          });

          document.querySelector('#dialogProgress').addEventListener('mdl-componentupgraded', function() {
            this.MaterialProgress.setProgress(0);
          });

          dialog.style.width = "60vw";
          dialogTextFieldDiv.style.width = "100%";
          dialogMultiLine.style.width = "100%";
          dialogMultiLineDiv.style.width = "100%";
          dialogMultiLine.style.height = "27vh";

        }

        function dialogNext() {

          var dialogTextField = document.getElementById("dialogTextField");
          var dialogTextFieldForm = document.getElementById("dialogTextFieldForm");
          var dialogTitle = document.getElementById("dialogTitle");
          var dialogNextButton = document.getElementById("dialogNextButton");
          var dialogProgress = document.getElementById("dialogProgress");
          var dialogInstructions = document.getElementById("dialogInstructions");
          var dialogLabel = document.getElementById("dialogLabel");
          var dialogMultiLine = document.getElementById("dialogMultiLine");
          var dialogMultiLineLabel = document.getElementById("dialogMultiLineLabel");
          var dialogNextButton = document.getElementById("dialogNextButton");


          switch (dialogInfo.page) {
            case 1:

              // NOTE: Set back everthing to normal.
              dialogNextButton.innerHTML = "Next";
              dialogTitle.innerHTML = "Add Module";

              if (dialogTextField.value != null) {

                dialogInfo.url = dialogTextField.value;

                dialogTextFieldForm.parentNode.removeChild(dialogTextFieldForm);
                dialogInstructions.innerHTML = "Paste Module's Default Config:";
                triggerHandicap({"dialogMultiLine": "show", "dialogMultiLineLabel": "show"});

                dialogInfo.page = dialogInfo.page + 1;
                dialogProgress.MaterialProgress.setProgress(dialogInfo.page * 33.33);
              }
            break;
            case 2:
              if (dialogMultiLine.value != null) {
                dialogInfo.config = dialogMultiLine.value;

                dialogMultiLine.parentNode.parentNode.removeChild(dialogMultiLine.parentNode);
                dialogNextButton.innerHTML = "Finish";
                dialogTitle.innerHTML = "Clone & Apply Module";
                dialogInstructions.innerHTML = "Click to download module onto MagicMirror and apply config.";

                dialogInfo.page = dialogInfo.page + 1;
                dialogProgress.MaterialProgress.setProgress(dialogInfo.page * 33.33);
              }
            break;

            case 3:

              sendOutData(parseConfigData(dialogInfo.config)).then(function (response) {
                if (response == true) {
                  console.log("Successfully added new module to the config.js");
                  sendOutGitHubRequest('clone', dialogInfo.url).then(function (response) {
                    if (response == true) {
                      // NOTE: Set URL hash to module's name i.e. (localhost:1984/#calendar)
                      var href = window.location.href;
                      var moduleIndex = (config.modules.length - 1);

                      if (href.indexOf("#") > 0) {
                        href = href.split("#")[0] + "?var=1#" + href.split("#")[1];
                        window.location.hash = '';
                      }
                      location.hash = ("#" + config.modules[moduleIndex].module);
                      location.reload();
                    } else {
                    console.error("[Error] GitHub Clone Request to download module to Mirror has failed. Check your MagicMirror console. Caught Error -> " + response);
                    snackBar(("Error sending out GitHub Clone request to server. Check Pi's console. "), 1);
                    alert(response);
                    }
                  });            
                } else {
                  console.error("[Error] Data sent to config has failed. Parsed config may be invalid. \nDetails -> " + response);
                  snackBar(("Error sending out data to config. Double check your pasted config. "), 1);
                  alert(response);
                }
              });
            
            break;

            default:
            break;
          }

        }

        function parseConfigData(text) {
          var substringed = text.substring(0, 7);
          var cfg = null;

          if (substringed == "modules") {
            cfg = eval(text);
            fullDynamicConfig.modules[fullDynamicConfig.modules.length] = cfg[0];
          } else {
            cfg = eval('('+text+')');
            fullDynamicConfig.modules[fullDynamicConfig.modules.length] = cfg;
          }

          var data = ("var config = " + JSON.stringify(fullDynamicConfig, null, "\t") + ";" + "\n if (typeof module !== 'undefined') {module.exports = config;}");
          return data;
        }

        // var string = "modules: [ { module: 'MMM-bitcoin', position: 'top_right', config: { fiat: 'usd', showBefore: 'foo', updateInterval: 60000 } }, ]";

        // eval('(')


    /**
    * End of, Modules-Tab Functions
    */




    /**
    * Tab #2 || Config-Tab Functions
    *
    * @function {Void} [v0.1] populateConfigCard() - Populate the Config-Tab (Tab-3) with a module's pre-made config.
    * @function {Void} [v0.1] populatePositionDropdown() - Populate the dropdown menu on the Config-Tab which lists possible positions for the module.
    * @function {Object} [v0.1] updateConfig() - Push fullDynamicConfig Object which containts a constatly updating version of the config.js file.
    * @function {Void} [v0.1] clearConfig() - Clear all inputs fromt the Config-Tab Card.
    * @function {Void} [v0.1] updateConfigUI() - Clear all config inputs and then re-populate Config-Tab Card with hashName.
    * @function {Void} [v0.1] updateConfigPositions() -
    * @dependency {JavaScript} [v0.1] mdl - The Material Design Lite package by Google.
    */

        /**
        * Populate Config Card - Populate the Config-Tab Card with a module's pre-made config. [v0.1]
        *
        * @param {Object} mod - The message being displayed.
        * @exception {Error} notConfigurable - The module that was passed didn't have a position or config to change.
        * @exception {Error} positionConfigurable - The module that was passed has a position but no config.
        * @dependency {JavaScript} mdl - The Material Design Lite package by Google.
        */
        function populateConfigCard(mod) {
          var ul = document.getElementById("configList");
          updateStatic = false;
          currentModule = mod;

          if (mod.config) {
            triggerHandicap({enableButton: "enable", updateButton: "disable", positionButton: "enable"});
            populatePositionDropdown();
            var configObjectMap = {};
            for (cfg in mod.config) {
              var li = document.createElement("li");
              li.className = "mdl-list__item lit";
              li.id = "configItem";
              var spanPrimary = document.createElement("span");
              spanPrimary.className = "mdl-list__item-primary-content";
              spanPrimary.innerHTML = cfg + ":  ";
              spanPrimary.style.padding = "10px";
              var spanSecondary = document.createElement("span");
              spanSecondary.className = "mdl-list__item-secondary-action";
              spanSecondary.id = cfg;
              if (mod.config[cfg] != "[object Object]") {
                var div = document.createElement("div");
                div.className = "mdl-textfield mdl-js-textfield mdl-textfield--floating-label is-upgraded";
                var input = document.createElement("input");
                input.className = "mdl-textfield__input";
                input.type = "text"
                input.id = cfg;
                li.onkeyup = function() {
                  buttonToggle("updateButton");
                }
                var label = document.createElement("label");
                label.className = "mdl-textfield__label";
                label.htmlFor = cfg
                label.textContent = mod.config[cfg];
                div.appendChild(input);
                div.appendChild(label);
                spanSecondary.appendChild(div);
              } else {
                configObjectMap[cfg] = mod.config[cfg][0];
                var button = document.createElement("button");
                button.id = "dropdown" + cfg;
                button.className = "mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon";
                var i = document.createElement("i");
                i.className = "material-icons";
                i.innerHTML = "arrow_drop_down";
                button.appendChild(i);
                spanSecondary.appendChild(button);
                button.onclick = function() {
                  extendConfigItem(this.parentNode.parentNode, configObjectMap[this.parentNode.id]);
                }
              }

              triggerHandicap({enableButton: "enable", updateButton: "disable", positionButton: "enable"});
              setTimeout(function () { componentHandler.upgradeDom('MaterialTextfield', 'mdl-textfield'); }, 10);
              li.appendChild(spanPrimary);
              li.appendChild(spanSecondary);
              ul.appendChild(li);
            }
          } else {
            if (mod.position == null) {
              if (mod.config == null) {
                triggerHandicap({updateButton: "disable", positionButton: "disable"});
                console.log("Module selected is not configurable.");
                snackBar((mod.module + ", module isn't configurable."), 2);
              }
            }
            else if (mod.position != null) {
              if (mod.config == null) {
                populatePositionDropdown();
                triggerHandicap({updateButton: "disable", positionButton: "enable", enableButton: "enable"});
                console.error(mod.module + ", does not have a config, but position is avaiable.");
                snackBar((mod.module + ", does not have a config, but position is avaiable."), 2);
              }
            }
          }
        }

        /**
        * Extend Config Card - Populate the Derivative Config-Tab Card with a module's child config. [v0.1]
        *
        * @param {Object} configItem - The configItem that we will be taking the Derivative of.
        * @param {Array} items - The items that will be placed underneath the configItem as their children inputs.
        * @dependency {JavaScript} mdl - The Material Design Lite package by Google.
        */
        function extendConfigItem(configItem, items) {
          var ul = document.createElement("ul");
          ul.className = "demo-list-control mdl-list";
          for (cfg in items) {
              var li = document.createElement("li");
              li.className = "mdl-list__item";
              li.id = cfg;
              li.style.padding = "0px 0px 0px 20px";
              var spanPrimary = document.createElement("span");
                spanPrimary.className = "mdl-list__item-primary-content";
                spanPrimary.innerHTML = cfg + ":  ";
                spanPrimary.style.padding = "10px";
                var spanSecondary = document.createElement("span");
                spanSecondary.className = "mdl-list__item-secondary-action";
                spanSecondary.id = cfg;
                if (items[cfg] != "[object Object]") {
                  var div = document.createElement("div");
                  div.className = "mdl-textfield mdl-js-textfield mdl-textfield--floating-label is-upgraded";
                  var input = document.createElement("input");
                      input.className = "mdl-textfield__input";
                      input.type = "text";
                      input.id = cfg;
                      li.onkeyup = function() {
                        updateToggle(this);
                      }
                    var label = document.createElement("label");
                      label.className = "mdl-textfield__label";
                      label.htmlFor = cfg;
                      label.textContent = items[cfg];
                      div.appendChild(input);
                      div.appendChild(label);
                      spanSecondary.appendChild(div);
                }
                else {
                  configObjectMap[cfg] = items[cfg][0];
                  var button = document.createElement("button");
                    button.id = "dropdown" + cfg;
                    button.className = "mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon";
                    var i = document.createElement("i");
                      i.className = "material-icons";
                      i.innerHTML = "arrow_drop_down";
                    button.appendChild(i);
                    spanSecondary.appendChild(button);
                    button.onclick = function() {
                          extendConfigItem(this.parentNode.parentNode, configObjectMap[this.parentNode.id]);
                        }
                  }

                  setTimeout(function () { componentHandler.upgradeDom('MaterialTextfield', 'mdl-textfield'); }, 10);
                  li.appendChild(spanPrimary);
                  li.appendChild(spanSecondary);
                  ul.appendChild(li);
            }
            configItem.appendChild(ul);
        }

        /**
        * Populate Positions Dropdown - Populate a dropdown menu in the Config-Tab which has only the available positions. [v0.1]
        *
        * @child {Function} positionsNotTaken() - Checks to see what positions are available for setting.
        * @dependency {JavaScript} mdl - The Material Design Lite package by Google.
        */
        function populatePositionDropdown() {
          var ul = document.getElementById("positionList");
          var validPositions = positionsNotTaken();

          for (pos in validPositions) {
            var li = document.createElement("li");
            li.className = "mdl-menu__item";
            li.innerHTML = validPositions[pos];
            li.id = "positionItem";
            ul.appendChild(li);
          }

          ul.addEventListener('click', function(e) {
            if (e.target.tagName == 'LI'){
              var icon = document.getElementById("positionButton");
              icon.style.color = "#ec4174";
              var updateButton = document.getElementById("updateButton");

              for (li in e.target.parentNode.childNodes) {
                if (e.target.parentNode.childNodes[li].tagName == 'LI') {
                  e.target.parentNode.childNodes[li].style.backgroundColor = "#FFFFFF"
                }
              }
              if (e.target.id == updatedPosition) {
                delete dynamicConfig.position;
                if (Object.keys(dynamicConfig).length == 0) {
                  updateButton.disabled = true;
                }
                updatedPosition = null;
                e.target.style.backgroundColor = "#FFFFFF";
                icon.style.color = "#FFFFFF";
              } else {
                updateButton.disabled = false;
                updatedPosition = e.target.id;
                e.target.style.backgroundColor = "#ec4174";
                dynamicConfig.position = e.target.id;
              }
            }
          });
        }

        /**
        * Update Config - Push fullDynamicConfig Object which contains a constantly updating version of the config.js file. [v0.1]
        *
        * @exception {Error} zeroChanges - Thrown when this function is called and their aren't any changes to make.
        */
        function updateConfig() {
          if (Object.keys(dynamicConfig).length > 0) {
            if (dynamicConfig.position != null) {
              fullDynamicConfig.modules[findModulePosition(currentModule.module)].position = dynamicConfig.position;
              delete dynamicConfig.position;
            }
            for (cfg in dynamicConfig) {
              fullDynamicConfig.modules[findModulePosition(currentModule.module)].config[cfg] = dynamicConfig[cfg];
            }
            checkConfigCardInputs();
            var data = ("var config = " + JSON.stringify(fullDynamicConfig, null, "\t") + ";" + "\n if (typeof module !== 'undefined') {module.exports = config;}");
            setTimeout(function () { sendOutData(data, currentModule); updateConfigUI(); }, 5);
          } else {
            console.error("This was caused by updateConfig() func being called with no config changes being made, yet updateButton was enabled.") }
        }

        /**
        * Clear Config - Clear all inputs in the Config-Tab Card. [v0.1]
        */
        function clearConfig() {
          var configCard = document.getElementById("configList");

          if (configCard.childNodes.length > 1) {
            for (li in configCard.childNodes) {
              if (configCard.childNodes[li].id == "configItem") {
                var input = configCard.childNodes[li].childNodes[1].childNodes[0].childNodes[0].value;
                input = null;
                triggerHandicap({updateButton: "disable"});
              }
            }
          }
        }

        /**
        * Update Config UI - Remove all configItems, positionItems and then re-populate with hashname Config-Tab. [v0.1]
        */
        function updateConfigUI() {
          // NOTE: Grab current URL hashName.
          var hashName = window.location.hash.substr(1, window.location.hash.lastIndexOf(''));

          // NOTE: Remove all configItems and positionItems.
          $("li[id=configItem]").remove();
          $("li[id=positionItem]").remove();

          // NOTE: Reset all UI to unselected state.
          var icon = document.getElementById("positionButton");
          icon.style.color = "#FFFFFF";

          // NOTE: Re-populate Config-Tab with current hashName's module.
          populateConfigCard(findModule(hashName));

          // NOTE: Present a snackBar on Positions-Tab (Tab-2).
          snackBar((hashName + ", module has been updated."), 2);
        }

        /** OPTIMIZE FOR VERSATILTIY
        * Button Toggle - Enable or Disable a button depending on if their are changes or not. [v0.1]
        *
        * @param {String} element - The element that will be affected.
        * @child {Function} checkConfigCardInputs() - Child function essential for updateToggle().
        */
        function buttonToggle(element) {
          var updateButton = document.getElementById(element);

          // NOTE: Child function responsible for the checks.
          checkConfigCardInputs();

          // NOTE: Setting usablity depending on changes >= 0.
          setTimeout(function () {
            if (Object.keys(dynamicConfig).length > 0) {
              updateButton.disabled = false;
            } else {
              updateButton.disabled = true;
            }
          }, 5);
        }

        /** OPTIMIZE FOR VERSATILTIY
        * Check Config Card Inputs - Check each input in Config-Tab and record the input's live and also delete entries with input's that are now null. [v0.1]
        *
        * @parent {Function} updateToggle() - Used constantly in order to toggle the updateButton in the Config-Tab, (Tab-2).
        */
        function checkConfigCardInputs() {
          var configCard = document.getElementById("configList");
          var newModuleConfig = {};

          // NOTE: Check if their is any inputs.
          if (configCard.childNodes.length > 1) {
            // NOTE: Loop through all inputs.
            for (li in configCard.childNodes) {
              if (configCard.childNodes[li].id == "configItem") {
                // NOTE: Filter null inputs and update newModuleConfig for later dynamicConfig accessing.
                var input = configCard.childNodes[li].childNodes[1].childNodes[0].childNodes[0].value;
                if (input != "") {
                  newModuleConfig[configCard.childNodes[li].childNodes[1].id] = input;
                } else {
                  delete newModuleConfig[configCard.childNodes[li].childNodes[1].id];
                }
              }
            }
          }
          dynamicConfig = newModuleConfig;
        }

    /**
    * End of, Config-Tab Functions
    */



    /**
    * Tab #3 || Positions-Tab Functions
    *
    * @function {Void} [v0.1] setupPositionTab() - Populate and set up the Positions-Tab with all positions.
    * @function {Void} [v0.1] updateConfigPositions() - Loops through all takenPositionsDynamic and sets them to their respectiv emodule in the fullDynamicConfig for publishing.
    */

        /**
        * Setup Position Tab - Populate and set up the Positions-Tab with all positions. [v0.1]
        *
        * @dependency {JavaScript} mdl - The Material Design Lite package by Google.
        */
        function setupPositionTab() {
          var allPositions = ["top_bar", "bottom_bar", "top_left", "bottom_left", "top_right", "bottom_right", "top_center", "bottom_center", "upper_third", "middle_center", "lower_third"];

          // NOTE: For each position in allPositions do, the following.
          for (pos in allPositions) {
            var positionCell = document.getElementById("pos-" + allPositions[pos]);
            var optionsList = document.createElement("ul");

            // NOTE: If position cell is taken by a module on-load
            if (mapModulePositionsReverse[allPositions[pos]]) {
              var takenModuleName = document.createElement("p");

              positionCell.style.backgroundColor = "#ec4174";
              takenModuleName.style.lineHeight = "10px";
              takenModuleName.style.marginBottom = "-10px";
              takenModuleName.innerHTML = mapModulePositionsReverse[allPositions[pos]];
              positionCell.appendChild(takenModuleName);
            }

            // NOTE: If not, we will still put in takenModuleName but will just be a placeholder. ^^
            else {
              var takenModuleName = document.createElement("p");

              takenModuleName.style.lineHeight = "10px";
              takenModuleName.style.marginBottom = "-10px";
              takenModuleName.innerHTML = "";
              positionCell.appendChild(takenModuleName);
            }

            positionCell.onclick = function () {
              if (selectedPosition != null) {
                var selectedPositionCell = document.getElementById(selectedPosition);
                var swapModuleName = this.childNodes[1].innerHTML;
                var pinkColor = "#ec4174";
                var blueColor = "#3b5bb4";

                selectedPositionCell.style.filter = "brightness(100%)";
                selectedPosition = null;

                // NOTE: The secondly clicked cell was pink.
                if (this.style.backgroundColor == "rgb(236, 65, 116)") {
                  // NOTE: The initially clicked cell was pink & the secondly clicked.
                  if (selectedPositionCell.style.backgroundColor == "rgb(236, 65, 116)") {
                    this.childNodes[1].innerHTML = selectedPositionCell.childNodes[1].innerHTML;
                    selectedPositionCell.childNodes[1].innerHTML = swapModuleName;
                    takenPositionsDynamic[this.childNodes[1].innerHTML] = this.id.substr(4);
                    takenPositionsDynamic[selectedPositionCell.childNodes[1].innerHTML] = selectedPositionCell.id.substr(4);
                  }
                  // NOTE: The initially clicked cell wasn't pink, but the second was.
                  else {
                    this.childNodes[1].innerHTML = selectedPositionCell.childNodes[1].innerHTML;
                    selectedPositionCell.childNodes[1].innerHTML = swapModuleName;
                    selectedPositionCell.style.backgroundColor = pinkColor;
                    this.style.backgroundColor = blueColor;
                    takenPositionsDynamic[selectedPositionCell.childNodes[1].innerHTML] = selectedPositionCell.id.substr(4);
                  }
                }
                else {
                  // NOTE: The secondly clicked cell wasn't pink, but the initial was.
                  if (selectedPositionCell.style.backgroundColor == "rgb(236, 65, 116)") {
                    this.childNodes[1].innerHTML = selectedPositionCell.childNodes[1].innerHTML;
                    selectedPositionCell.childNodes[1].innerHTML = swapModuleName;
                    selectedPositionCell.style.backgroundColor = blueColor;
                    this.style.backgroundColor = pinkColor;
                    takenPositionsDynamic[this.childNodes[1].innerHTML] = this.id.substr(4);
                  } else {
                    // NOTE: Both selectedPositionCell's were Blue aka no point in commiting the swap.
                    console.log("Client selected two position cells that are not set.");
                  }
                }

              } else {
                // NOTE: If cell is pink, put a pink shadow behind selected cell.
                if (this.style.backgroundColor == "rgb(236, 65, 116)") {
                  this.style.filter = "drop-shadow(9px 9px 9px rgba(224, 88, 122, 1)) brightness(105%)";
                }
                // NOTE: If cell is blue, put a blue shadow behind selected cell.
                else {
                  this.style.filter = "drop-shadow(9px 9px 9px rgba(58, 89, 176, 1)) brightness(105%)";
                }
                selectedPosition = this.id;
              }
            }
          }
        }

        /**
        * Update Config Positions - Loops through all takenPositionsDynamic and sets them to their respective module in the fullDynamicConfig for publishing. [v0.1]
        *
        * @logging {Info} success - Logs that the client has pushed successfully, and also gives them a snackBar.
        * @parent {Function} updateConfig() - Anti-Derivative of this function. Used for pushing Config-Tab updates.
        */
        function updateConfigPositions() {
          // NOTE: Loop through all takenPositionsDynamic to update fullDynamicConfig's module's positions.
          for (pos in takenPositionsDynamic) {
            fullDynamicConfig.modules[findModulePosition(pos)].position = takenPositionsDynamic[pos];
          }
          // NOTE: Parse all the fullDynamicConfig with the changes.
          var data = ("var config = " + JSON.stringify(fullDynamicConfig, null, "\t") + ";" + "\n if (typeof module !== 'undefined') {module.exports = config;}");

          // NOTE: Present a snackBar to Positions-Tab (Tab-3).
          snackBar("Successfully pushed positions-config update.", 3);

          // NOTE: Finally, push out the data, and log the push (Both on the client's console and server's.)
          setTimeout(function () { sendOutData(data, currentModule);
            console.log("Client has pushed a positions config change."); }, 5);
        }


    /**
    * End of, Positions-Tab Functions
    */


appendModules();
handleDialogue();
parseModules();
setupPositionTab();
triggerHandicap({updateButton: "disable", positionButton: "disable"});
checkHash();
</script>

<script src="node_modules/material-components-web/dist/material-components-web.min.js"></script>
<script>window.mdc.autoInit();</script>

 <!--
<form action="/github_upload.php">
	<br></br><br></br>
	<h3> Add New Module: </h3>
	<input type="text" placeholder="Module's GitHub URL"></input>
	<input type="submit" value="Submit">
</form>
 -->


</body>
</html>
