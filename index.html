<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MMMM</title>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="./mdl/material.css">
  <script src="./mdl/material.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <style>
  .demo-card-wide.mdl-card {
    width: 512px;
  }
  .demo-card-wide > .mdl-card__title {
    color: #fff;
    height: 65px;
    background-color: #485cb0;
  }
  .demo-card-wide > .mdl-card__menu {
    color: #fff;
  }

  .demo-list-control {
    width: 300px;
  }
  .demo-list-radio {
    display: inline;
  }

  #sortable1, #sortable2, #sortable3 {
    border: 1px solid #eee;
    width: 200px;
    min-height: 20px;
    list-style-type: none;
    margin: 0;
    padding: 5px 0 0 0;
    float: left;
    margin-right: 10px;
  }
  #sortable1 li, #sortable2 li, #sortable3 li {
    margin: 0 5px 5px 5px;
    padding: 5px;
    font-size: 1.2em;
    width: 120px;
  }
  </style>
  <script src="http://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  $( function() {
    $( "#sortable1, #sortable2, #sortable3" ).sortable({
      connectWith: ".connectedSortable"
    }).disableSelection();
  } );
  </script>
</head>

<body>

<!-- Start Main Grid -->
  <main class="mdl-layout__content mdl-color--grey-100">
    <div class="mdl-grid demo-content">

      <!-- Start Module List Card -->
      <ul id="sortable1" class="connectedSortable mdl-shadow--2dp">
        <h3 align="center">Modules</h3>
      </ul>

      <!-- Start Config Card -->
      <div class="demo-card-wide mdl-card mdl-shadow--2dp">

        <div class="mdl-card__title">
          <h2 class="mdl-card__title-text">Config</h2>
        </div>

        <ul id="configList" class="demo-list-control mdl-list">
          <li class="mdl-list__item" id="superman">
            <span class="mdl-list__item-primary-content">
              <i class="material-icons  mdl-list__item-icon">chrome_reader_mode</i>
              Enabled
            </span>
            <span class="mdl-list__item-secondary-action">
              <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="list-switch-1">
                <input type="checkbox" id="list-switch-1" class="mdl-switch__input" checked />
              </label>
            </span>
          </li>
        </ul>
        <!-- <li class="mdl-list__item">
        <span class="mdl-list__item-primary-content">Title:</span>
          <span class="mdl-list__item-secondary-action">
             <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                <input class="mdl-textfield__input" type="text" id="sample2">
                <label class="mdl-textfield__label" for="sample3">Text...</label>
             </div>
          </span>
        </li> -->

        <div class="mdl-card__actions mdl-card--border">
        </div>

          <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
            Update
          </a>


          <!-- Position Button - Top Right -->
          <div class="mdl-card__menu">
            <button id="demo-menu-lower-right"
                    class="mdl-button mdl-js-button mdl-button--icon">
              <i class="material-icons">my_location</i>
            </button>
          </div>
          <ul id="positionList" class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect"
            for="demo-menu-lower-right">
          </ul>
          <!-- End Position Button -->
    </div>

    <div id="demo-toast-example" class="mdl-js-snackbar mdl-snackbar">
      <div class="mdl-snackbar__text"></div>
      <button class="mdl-snackbar__action" type="button"></button>
    </div>
  </main>


<script src="config.js"></script>

<script>
  var rawModules = config.modules;
  var arrayModules = [];
  var mapModulePositions = {};
  var updatedPosition = null;
  var currentPosition = null;

function appendModules() {
  var ul = document.getElementById("sortable1");
  // Sortable 1 Variable list
  var buttonWidthSync = "180px";
  var arryNumber = -1;


  for (mod in rawModules) {
    var li = document.createElement("li");
    var btn = document.createElement("button");
    li.appendChild(btn);
    li.className = "ui-state-default";
    li.className = "mdl-button mdl-button--raised mdl-button--colored";
    li.className = "mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored";
    li.innerHTML = rawModules[mod].module;
    li.style = "cursor:pointer";
    li.style.fontSize = "1.3vw";
    li.style.width = buttonWidthSync;
    arrayModules.push(rawModules[mod].module);
    arryNumber = arryNumber + 1;
    li.id = arryNumber;
    ul.appendChild(li);
  }
  ul.addEventListener('click', function(e) {
      if (e.target.tagName == 'SPAN'){
        var targetName = arrayModules[e.target.parentNode.id];
        $("li[id=configItem]").remove();
        $("div[id=configItem]").remove();
        setTimeout(function () {populateConfigCard(findModule(targetName)); }, 20);
      }
  });
}

function populateConfigCard(mod) {
  var ul = document.getElementById("configList");
  if (mod.config != null) {
  for (cfg in mod.config) {
    var li = document.createElement("li");
      li.className = "mdl-list__item lit";
      li.id = "configItem";
      var spanPrimary = document.createElement("span");
        spanPrimary.className = "mdl-list__item-primary-content";
        spanPrimary.innerHTML = cfg + ":  ";
      var spanSecondary = document.createElement("span");
        spanSecondary.className = "mdl-list__item-secondary-action";
        var div = document.createElement("div");
        div.className = "mdl-textfield mdl-js-textfield mdl-textfield--floating-label is-upgraded";
        div.id = cfg;
        setTimeout(function () { componentHandler.upgradeDom('MaterialTextfield', 'mdl-textfield'); }, 10);
          var input = document.createElement("input");
            input.className = "mdl-textfield__input";
            input.type = "text";
            input.id = cfg;
          var label = document.createElement("label");
            label.className = "mdl-textfield__label";
            label.htmlFor = cfg;
            label.textContent = mod.config[cfg];
          div.appendChild(input);
        div.appendChild(label);
        ul.appendChild(li);
      spanSecondary.appendChild(div);
    li.appendChild(spanPrimary);
  li.appendChild(spanSecondary);

      }
    } else {
      // $("div[id=configItem]").remove();
      // var h = document.createElement("div");
      // h.id = "configItem";
      // h.innerHTML = "Module doesn't have Config";
      // ul.appendChild(h);
      snackBar(mod.module + ", module doesn't have a config");
    }
}

function parseModule(mod) {
  if (mod.config != null) {
    console.info("Module does have a config.")
  }
  if (mod.position != null) {
    console.info("Module does have a position");
  }
}


function populatePositionDropdown() {
  var ul = document.getElementById("positionList");
  var validPositions = positionsNotTaken();

  for (pos in validPositions) {
      var li = document.createElement("li");
      li.className = "mdl-menu__item";
      li.innerHTML = validPositions[pos];
      li.id = validPositions[pos];
      ul.appendChild(li);
  }
  ul.addEventListener('click', function(e) {
      if (e.target.tagName == 'LI'){
        var icon = document.getElementById("demo-menu-lower-right");
        icon.style.color = "#485cb0";
        updatedPosition = e.target.id;
      }
  });
}

  function findModule(name) {
    for (mod in rawModules) {
      if (rawModules[mod].module == name) {
          //console.info(rawModules[mod]);
          return rawModules[mod];
        }
      }
    }

  function parseModules() {
    for (mod in rawModules) {
      if (rawModules[mod].position != null) {
        mapModulePositions[rawModules[mod].module] = rawModules[mod].position;
      }
    }
  }

  function positionsNotTaken() {
    var allPositions = ["top_bar", "bottom_bar", "top_left", "bottom_left", "top_right", "bottom_right", "top_center", "bottom_center", "upper_third", "middle_center", "lower_center"];
    var notTaken = [];
    for (pos in mapModulePositions) {
      for (var i=allPositions.length-1; i>=0; i--) {
        if (allPositions[i] === mapModulePositions[pos]) {
            allPositions.splice(i, 1);
          }
        }
      }
      return allPositions;
  }

  function sortClick() {
      var sortableItems = $('#sortable1').find('li');
		    var order = ['Calendar', 'Clock', 'Alarm Clock', 'Weather'];
        var orderedItems = $.map(order, function(value) {
          return sortableItems.get(value);
        });

        $('#sortable1').empty().html(order);
      }

    function snackBar(msg) {
        var snackbarContainer = document.querySelector('#demo-toast-example');
        var data = {message: msg};
        snackbarContainer.MaterialSnackbar.showSnackbar(data);
    }

appendModules();
parseModules();
populatePositionDropdown();
</script>

<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
<script>window.mdc.autoInit();</script>

 <!--
<form action="/github_upload.php">
	<br></br><br></br>
	<h3> Add New Module: </h3>
	<input type="text" placeholder="Module's GitHub URL"></input>
	<input type="submit" value="Submit">
</form>
 -->


</body>
</html>
